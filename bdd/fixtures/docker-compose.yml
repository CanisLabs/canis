#
# Copyright Scoir Inc. All Rights Reserved.
#
# SPDX-License-Identifier: Apache-2.0
#

version: '2'

services:

  alice.canis.example.com:
    container_name: alice.canis.example.com
    image: canislabs/canis:latest
    environment:
      - ARIESD_API_HOST=${ALICE_HOST}:${ALICE_API_PORT}
      - ARIESD_INBOUND_HOST=${HTTP_SCHEME}@${ALICE_HOST}:${ALICE_INBOUND_PORT}
      - ARIESD_INBOUND_HOST_EXTERNAL=${HTTP_SCHEME}@https://alice.aries.example.com:${ALICE_INBOUND_PORT}
      - ARIESD_WEBHOOK_URL=http://${ALICE_WEBHOOK_CONTAINER_NAME}:${ALICE_WEBHOOK_PORT}
      - ARIESD_DEFAULT_LABEL=alice-agent
      - ARIESD_DATABASE_TYPE=leveldb
      - ARIESD_DATABASE_PREFIX=alice
      - ARIESD_DATABASE_TIMEOUT=60
      - ARIESD_HTTP_RESOLVER=${HTTP_DID_RESOLVER}
      - TLS_CERT_FILE=/etc/tls/ec-pubCert.pem
      - TLS_KEY_FILE=/etc/tls/ec-key.pem
    volumes:
      - ../keys/tls:/etc/tls
    ports:
      - ${ALICE_INBOUND_PORT}:${ALICE_INBOUND_PORT}
      - ${ALICE_API_PORT}:${ALICE_API_PORT}
    entrypoint: ""
    command: /bin/sh -c "cp /etc/tls/* /usr/local/share/ca-certificates/;update-ca-certificates; aries-agent-rest start"
    networks:
      - bdd_net

networks:
  bdd_net:
    driver: bridge
